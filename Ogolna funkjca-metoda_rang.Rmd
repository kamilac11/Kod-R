---
title: "Funkcja dokonuj¹ca porz¹dkowania za pomoc¹ metody rang"
#author: "Kamila Choja"
#date: "22 maja 2018"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```
#Wstêp

Na pocz¹tku u¿ytkownik przed skorzystaniem z funkcji musi zaimportowaæ dane, które chce poddaæ porz¹dkowaniu. W tym celu mo¿e u¿yæ np. takiego wywo³ania z podaniem swojej œcie¿ki pliku formatu xlsx, który chce poddaæ porz¹dkowaniu.
Jako przyk³ad zaimportowa³am tabele zawieraj¹c¹ 8 obiektów, bêd¹cych ofertami sprzeda¿y aut. 

```{r}
library(readxl)
zbior_danych <- read_excel("datasets/8_Rozniacych_sie_obiektow.xlsx", 
                           sheet = "Arkusz1", col_types = c("numeric","text", 
                           "text", "text", "text", "text",                                                                              "blank","numeric", "numeric", "numeric", 
                              "numeric", "numeric", "text",  "numeric", 
                              "text", "text", "text", "text","text", 
                                  "text", "numeric", "text", "text", 
                                   "text", "numeric", "numeric",                                                                              "numeric", 
                                   "numeric", "numeric", "numeric"))

```
Podgl¹d danych:
```{r}
head(zbior_danych)
```
##Podzbiór danych

W kolejnym, kroku po przyjrzeniu siê zbiorowi danych, u¿ytkownik musi zadecydowaæ na których danych iloœciowych chce pracowaæ - wa¿na jest znajomoœæ danych. Dodatkowo pierwsz¹ kolumn¹ musi byæ kolumna zawieraj¹ca numery indeksów obiektów, ze wzglêdu na to, ¿e w wyniku zastosowania funkcji odpowiedzialnej za porz¹dkowanie, zostan¹ zwrócone w kolejnoœci malej¹cej numery indeksów, mówi¹ce o kolejnoœci uporz¹dkowania. W zwi¹zku z tym, za pomoc¹ poni¿szej procedury u¿ytkownik tworzy podzbiór zaimportowanego zbioru, gdzie w miejsce "" wpisuje nazwy kolumn zawieraj¹cych zmienne iloœciowe, wybrane do porz¹dkowania(przyjmijmy za³o¿enie, ¿e podzbiór bêdzie nazywa³ siê dane_porzadkowanie - bêdzie to pomocne w dalszej czêœci programu).
U mnie wybranymi kolumnami s¹: cena, moc, pojemnoœæ, rok produkcji, przebieg. 
```{r}
dane_porzadkowanie<-zbior_danych[c("Nr","CENA.BRUTTO_[pln]","MOC_[km]",
                                   "POJEMNOSC.SKOKOWA_[cm3]",
                                   "ROK.PRODUKCJI","PRZEBIEG_[km]")]

```
##Transformacje danych

Chc¹c zastosowaæ metodê rang do uporz¹dkowania zbioru, wymaganym jest aby zmienne mia³y charakter stymulant oraz by zosta³y poddane transformacji normalizacyjnej. Aby funckja dokonuj¹ca porz¹dkowania dawa³a poprawny wynik, u¿utkownik musi zaj¹æ siê tranformacj¹ przed jej zastosowaniem. Poni¿ej poda³am tego przyk³ad.
Dla zmiennych które stymulantami nie s¹, nale¿y dokonaæ stymulacji. Wsród moich zmiennych poddanych porz¹dkowaniu, do stymulant nie nale¿y zmienna zmienna: przebieg - jest destymulant¹, w zwi¹zku z tym,  zosta³a przekszta³cona na stymulante, za pomoc¹ przekszta³cenia ilorazowego:

```{r}
for (i in 1:nrow(dane_porzadkowanie)){
  dane_porzadkowanie[i,which(colnames(dane_porzadkowanie)=="PRZEBIEG_[km]")]=
    1/dane_porzadkowanie[i,which(colnames(dane_porzadkowanie)=="PRZEBIEG_[km]")]
}
```

W celu uzyskania porównywalnoœci miêdzy zmiennymi, zosta³y one poddane transofrmacji normalizacyjnej - unitaryzacji, dziêki temu wartoœci ka¿dej zmiennej nale¿¹ do przedzia³u [0,1]


```{r}
maksi=0
minim=0
for (j in 2:ncol(dane_porzadkowanie)){
  maksi[j]=max(dane_porzadkowanie[j])
  minim[j]=min(dane_porzadkowanie[j])
  for (i in 1:nrow(dane_porzadkowanie)){
    dane_porzadkowanie[i,j]=(dane_porzadkowanie[i,j]-minim[j])/(maksi[j]-minim[j])
  }
}
```

##Funkcja porz¹dkuj¹ca metod¹ rang

W celu dokonania porz¹dkowania na unormowanych danych, nale¿y zastosowaæ poni¿sz¹ funkcjê tj. funkcja_porzadkowanie_metoda_rang, która jest postaci:

```{r}
funkcja_porzadkowanie_metoda_rang<-function(x){
  y<-x #dzieki temu nie bede sztywno odwolywac sie do 1kolumny rang
  for (i in 2:ncol(x)){
    x[ncol(x)+1]=rank(-x[i])
  }
  #ostania kolumna to zmienna_syntetyczna - za pomoca metody sredniej arytmetycznej
    x[,"zmienna_syntetyczna"] <-0
      for(i in 1:nrow(x)){
        for(j in (ncol(y)+1):(ncol(x)-1)){
          x[i,ncol(x)]=x[i,ncol(x)]+x[i,j]
            j=j+1
      }
    x[i,ncol(x)]=x[i,ncol(x)]/(ncol(x)-7)
    }
  x<-x[order(x$zmienna_syntetyczna),]
  print("Numery indeksów obiektów po uporz¹dkowaniu: ")
  return(x[1])
}
```

Wywo³anie funkcji dla zbioru dane_porzadkowanie - podzbioru wyjœciowych danych

```{r}
funkcja_porzadkowanie_metoda_rang(dane_porzadkowanie)

```

Na podstawie powy¿szego wyniku, widaæ, ¿e 1-wsze miejsce zajê³a oferta sprzeda¿y z numerem indeksu = 2, a ostatnie oferta z numerem indeksu o numerzer 7.  

